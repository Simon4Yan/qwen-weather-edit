<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Driving Weather Condition Change (Qwen API)</title>
  <style>
    body {
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      max-width: 900px;
      margin: 40px auto;
      padding: 0 16px;
    }
    h1 {
      font-size: 24px;
      margin-bottom: 16px;
    }
    .row {
      margin-bottom: 16px;
    }
    .label {
      font-weight: 600;
      margin-bottom: 4px;
    }
    input[type="file"],
    input[type="text"] {
      width: 100%;
      padding: 8px;
      box-sizing: border-box;
    }
    button {
      padding: 8px 16px;
      font-size: 14px;
      cursor: pointer;
      margin-right: 8px;
    }

    /* image layout */
    #result-wrapper {
      margin-top: 24px;
      display: flex;
      gap: 16px;
      flex-wrap: wrap;
    }
    .img-box {
      flex: 1 1 300px;
    }
    .img-box img {
      max-width: 100%;
      border: 1px solid #ddd;
      border-radius: 4px;
      cursor: zoom-in;
    }

    #status {
      margin-left: 12px;
      font-size: 13px;
      color: #666;
    }

    /* zoom modal */
    #zoomModal {
      position: fixed;
      display: none;
      z-index: 9999;
      left: 0; top: 0;
      width: 100vw; height: 100vh;
      background: rgba(0,0,0,0.85);
      justify-content: center;
      align-items: center;
    }
    #zoomModal img {
      max-width: 90%;
      max-height: 90%;
      border-radius: 4px;
    }
  </style>
</head>
<body>
<h1 style="
  text-align:center;
  font-size:28px;
  font-weight:700;
  margin-bottom:24px;
">
  Driving Weather Condition Change (Qwen API)
</h1>
<div class="row">
  <div class="label">1. Upload image:</div>
  <input type="file" id="image" accept="image/*" />
</div>

<div class="row">
  <div class="label">2. Please input a prompt:</div>
  <input
          type="text"
          id="prompt"
          placeholder="Enter a weather editing prompt..."
  />
</div>

<!-- Predefined prompt buttons -->
<div class="row">
  <div class="label">Or choose a preset weather condition:</div>

  <!-- Rainy -->
  <button onclick="setPrompt(`Change the scene to rainy weather while keeping all objects and layout identical. Completely remove all traces of the original weather, including sunlight, blue sky, strong shadows, warm highlights, or dry road surfaces. Replace them with fully rainy conditions: overcast gray lighting, wet reflective roads, rain streaks, dark clouds, and increased atmospheric moisture. Maintain the exact original resolution and detail level without adding new textures or upscaling. Only modify the weather.`)">
    üåß Rainy
  </button>

  <!-- Foggy -->
  <button onclick="setPrompt(`Change the scene to foggy weather while preserving all objects and layout exactly the same. Remove every trace of the previous weather, including sunlight, clear sky tint, strong shadows, and high-contrast reflections. Replace them with dense fog, reduced visibility, softened global lighting, desaturated colors, and uniform atmospheric scattering. Keep the image resolution and sharpness level identical to the original without adding extra details. Only the weather should change.`)">
    üå´ Foggy
  </button>

  <!-- Snowy -->
  <button onclick="setPrompt(`Change the scene to snowy weather while keeping all objects, geometry, and viewpoint unchanged. Remove all previous-weather artifacts such as sunlight, dry ground, warm tones, clear sky, or directional shadows. Replace them with overcast cold lighting, falling snow particles, snow accumulation on surfaces, and a winter atmospheric tone. Keep the exact same resolution and detail density as the original and do not introduce new structures.`)">
    ‚ùÑ Snowy
  </button>

  <!-- Overcast -->
  <button onclick="setPrompt(`Change the scene to fully overcast weather while preserving all objects and layout. Remove all signs of direct sunlight, blue sky, strong shadows, and warm highlights. Use soft gray ambient lighting, uniformly lit surfaces, and a slightly desaturated atmosphere. Maintain the original image resolution and detail level without enhancing or adding new details. Only change the global lighting and sky condition.`)">
    ‚òÅ Overcast
  </button>

  <!-- Night-time -->
  <button onclick="setPrompt(`Convert the scene to night-time while preserving all objects and layout. Remove all previous daytime weather cues such as sunlight, bright sky, and hard shadows. Replace them with realistic night illumination: low ambient light, cool tones, car headlights and streetlights as primary light sources, and a dark sky. Do not modify the resolution, texture density, or introduce new scene objects; only update the lighting and atmosphere.`)">
    üåô Night-time
  </button>

  <!-- Heavy Rain -->
  <button onclick="setPrompt(`Make the weather heavy rain while keeping all scene content and layout identical. Eliminate all traces of the previous weather, including sunlight, blue sky, strong shadows, and dry roads. Replace them with dark, overcast lighting, intense rainfall, wet and reflective road surfaces, visible rain streaks, and heavy clouds. Maintain the exact same image resolution, texture level, and sharpness as the original without any upscaling or extra detail generation.`)">
    üåß Heavy Rain
  </button>
</div>

<div class="row">
  <button onclick="edit()">Start Editing</button>
  <span id="status"></span>
</div>

<div id="result-wrapper">
  <div class="img-box">
    <div class="label">Original:</div>
    <img id="original" onclick="zoom(this)" />
  </div>
  <div class="img-box">
    <div class="label">Edited:</div>
    <img id="result" onclick="zoom(this)" />
  </div>
</div>

<!-- Zoom modal -->
<div id="zoomModal" onclick="closeZoom()">
  <img id="zoomedImg" />
</div>

<script>
  const API_BASE = "https://qwen-weather-backend.onrender.com";

  function setPrompt(text) {
    document.getElementById("prompt").value = text;
  }

  function zoom(img) {
    const modal = document.getElementById("zoomModal");
    const zoomImg = document.getElementById("zoomedImg");
    zoomImg.src = img.src;
    modal.style.display = "flex";
  }

  function closeZoom() {
    document.getElementById("zoomModal").style.display = "none";
  }

  async function edit() {
    const fileInput = document.getElementById("image");
    const promptInput = document.getElementById("prompt");
    const statusEl = document.getElementById("status");
    const originalImg = document.getElementById("original");
    const resultImg = document.getElementById("result");

    const file = fileInput.files[0];
    const prompt = promptInput.value.trim();

    if (!file) {
      alert("Please select an image.");
      return;
    }
    if (!prompt) {
      alert("Please enter a prompt.");
      return;
    }

    // preview
    const reader = new FileReader();
    reader.onload = (e) => {
      originalImg.src = e.target.result;
    };
    reader.readAsDataURL(file);

    const formData = new FormData();
    formData.append("file", file);
    formData.append("prompt", prompt);

    statusEl.textContent = "Calling Qwen API‚Ä¶";

    try {
      const resp = await fetch(API_BASE + "/api/edit", {
        method: "POST",
        body: formData
      });

      const data = await resp.json();

      if (!data.success) {
        statusEl.textContent = "Error: " + (data.error || data.error_message);
        return;
      }

      resultImg.src = data.image_url;
      statusEl.textContent = "Done ‚úÖ";
    } catch (err) {
      console.error(err);
      statusEl.textContent = "Backend error. Is FastAPI running?";
    }
  }
</script>
</body>
</html>